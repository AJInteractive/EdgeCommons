#!/bin/bash

echo "Compiling...";

# --compilation_level WHITESPACE_ONLY | SIMPLE_OPTIMIZATIONS | ADVANCED_OPTIMIZATIONS
# --formatting PRETTY_PRINT | PRINT_INPUT_DELIMITER

VERSION="0.9.0"

# PREPARE
mkdir -p ../sprint/$VERSION
mkdir -p ../sprint/$VERSION/css
mkdir -p ../sprint/$VERSION/js/min

# COPY CSS
cp -rf ../src/css ../sprint/$VERSION
echo "Job done: Style Sheets"

# REPLACE VERSION NO
#echo $1 | sed 's#EdgeCommons.VERSION = "\([0-9].[0-9].[0-9]\)";#EdgeCommons.VERSION = "'$VERSION'"#g' ../src/EdgeCommons.js
sed -i.bak 's#EdgeCommons.VERSION = "\([0-9].[0-9].[0-9]\)";#EdgeCommons.VERSION = "'$VERSION'"#g' ../src/EdgeCommons.js
unlink ../src/EdgeCommons.js.bak

##########################################
# Job: Experimental
##########################################
FILE="../sprint/$VERSION/js/min/EdgeCommons.Experimental.js"
java -jar compiler.jar \
    --compilation_level SIMPLE_OPTIMIZATIONS \
    --formatting PRINT_INPUT_DELIMITER \
    --js_output_file $FILE \
    --js ../src/libs/Modulog-0.0.2.js \
    --js ../src/EdgeCommons.js \
    --js ../src/modules/Core/Core.js \
    --js ../src/modules/Preload/Preload.js \
    --js ../src/modules/Sound/Sound.js \
    --js ../src/modules/Parallax/Parallax.js \
    --js ../src/modules/Spotlight/Spotlight.js \
    --js ../src/modules/Experimental/Experimental.js \

sed -i '1i Text to prepend' ../src/EdgeCommons.js
echo "Job done: Experimental";


##########################################
# Job: All-in-One
##########################################
java -jar compiler.jar \
    --compilation_level SIMPLE_OPTIMIZATIONS \
    --formatting PRINT_INPUT_DELIMITER \
    --js_output_file ../sprint/$VERSION/js/min/EdgeCommons.js \
    --js ../src/libs/Modulog-0.0.2.js \
    --js ../src/EdgeCommons.js \
    --js ../src/modules/Core/Core.js \
    --js ../src/modules/Preload/Preload.js \
    --js ../src/modules/Sound/Sound.js \
    --js ../src/modules/Parallax/Parallax.js \
    --js ../src/modules/Spotlight/Spotlight.js \

echo "Job done: All-in-One";


##########################################
# Job: Core
##########################################
java -jar compiler.jar \
    --compilation_level SIMPLE_OPTIMIZATIONS \
    --formatting PRINT_INPUT_DELIMITER \
    --js_output_file ../sprint/$VERSION/js/min/EdgeCommons.Core.js \
    --js ../src/libs/Modulog-0.0.2.js \
    --js ../src/EdgeCommons.js \
    --js ../src/modules/Core/Core.js \

echo "Job done: Core";


##########################################
# Job: Spotlight
##########################################
java -jar compiler.jar \
    --compilation_level SIMPLE_OPTIMIZATIONS \
    --formatting PRINT_INPUT_DELIMITER \
    --js_output_file ../sprint/$VERSION/js/min/EdgeCommons.Spotlight.js \
    --js ../src/modules/Spotlight/Spotlight.js \

echo "Job done: Spotlight";